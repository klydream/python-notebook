Host: Debian OS

(1) Download source to host OS
$ cd ~/src/
$ git clone https://github.com/zenodo/zenodo.git

(2) Start docker containers build in step2. This step could be done before step9.
docker-compose up db es cache mq
问题1：docker下载速度较慢：解决方法：
1、阿里加速器：https://cr.console.aliyun.com/#/accelerator；
2、
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://htxclokc.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
问题2：阿里云访问github速度过慢导致RUN plugin install royrusso/elasticsearch-HQ/v2.0.3总是失败：
docker运行的应该是elasticsearch的内部命令，运行该命令之后会返回几个网址，挑选合适的下载，实际上只有一个网址可用，https://github.com/ElasticHQ/elasticsearch-HQ/archive/v2.0.3.zip，本地直接下载后，上传到/root/src/zenodo/docker/es/src下，这个有严格的要求，需要位于docker文件所在的根目录。然后再dock/es/Dockerfile里添加本地文件和容器内的映射关系，修改完代码如下：

FROM elasticsearch:2
ADD ./src /src
RUN plugin install file:///src/elasticsearch-HQ-2.0.3.zip
RUN plugin install mapper-attachments


(3) Check and clean OS default python environment.  download Anaconda2-5.1.0-Linux-x86_64.sh, Anaconda3-5.1.0-Linux-x86_64.sh and install, but I want get python version == 3.5, so I run command "conda install python=3.5" and I got a error as below:
conda install python=3.5
Solving environment: failed

UnsatisfiableError: The following specifications were found to be in conflict:
  - python=3.5
  - requests -> chardet[version='>=3.0.2,<3.1.0'] -> python[version='>=3.6,<3.7.0a0']
Use "conda info <package>" to see the dependencies for each package.
I haven't never met this error on other computer, so I download Anaconda3-4.1.1-Linux-x86_64.sh again
and install.

(5) create vritual env.
conda create -n zenodo python=3.5.2
and add 清华加速镜像：
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --set show_channel_urls yes

(6) Install npm on host os
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
add native mirror:
npm install -g cnpm --registry=https://registry.npm.taobao.org


(7) Create virtual python environment
source activate zenodo

(8) Build zenodo on host os, this should be done under virtual python environment created in step7.
(zenodo)$
(zenodo)$ cd ~/src/zenodo
(zenodo)$ pip install -r requirements.txt --src ~/src/ --pre --upgrade
(zenodo)$ pip install -e .[all,postgresql,elasticsearch2]
(zenodo)$ ./scripts/setup-npm.sh
(zenodo)$ ./scripts/setup-assets.sh
first I meet error:
because I don't use virtuaimport cairo  # pycairo
ImportError: No module named 'cairo'
This command "sudo apt-get install libcairo2" will solve this problem
because I don't use mkvirtualenv, so I will meet 
./scripts/setup-assets.sh: line 29: cd: /var/instance/static: No such file or directory
and I directly run 
npm install
in directory ~/anaconda3/envs/zenodo/var/instance/static
will be ok

(9) Initialize zenodo:
(zenodo)$ ./scripts/init.sh


