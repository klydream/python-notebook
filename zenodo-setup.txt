Host: Debian OS

(1) Download source to host OS
$ cd ~/src/
$ git clone https://github.com/zenodo/zenodo.git

(2) Start docker containers build in step2. This step could be done before step9.
docker-compose up db es cache mq
问题1：docker下载速度较慢：解决方法：
1、阿里加速器：https://cr.console.aliyun.com/#/accelerator；
2、
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://htxclokc.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
问题2：阿里云访问github速度过慢导致RUN plugin install royrusso/elasticsearch-HQ/v2.0.3总是失败：
docker运行的应该是elasticsearch的内部命令，运行该命令之后会返回几个网址，挑选合适的下载，实际上只有一个网址可用，https://github.com/ElasticHQ/elasticsearch-HQ/archive/v2.0.3.zip，本地直接下载后，上传到/root/src/zenodo/docker/es/src下，这个有严格的要求，需要位于docker文件所在的根目录。然后再dock/es/Dockerfile里添加本地文件和容器内的映射关系，修改完代码如下：
FROM elasticsearch:2
ADD ./src /src
RUN plugin install file:///src/elasticsearch-HQ-2.0.3.zip
RUN plugin install mapper-attachments

问题3： intall docker-compose
sudo curl -L https://github.com/docker/compose/releases/download/1.20.1/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose

问题4：如果不是root用户
You need to add user into docker group. by 'sudo gpasswd -a xxxx docker' (xxx is your user name)
Then restart your computer.

(3) Check and clean OS default python environment.  download Anaconda2-5.1.0-Linux-x86_64.sh, Anaconda3-5.1.0-Linux-x86_64.sh and install, but I want get python version == 3.5, so I run command "conda install python=3.5" and I got a error as below:
conda install python=3.5
Solving environment: failed

UnsatisfiableError: The following specifications were found to be in conflict:
  - python=3.5
  - requests -> chardet[version='>=3.0.2,<3.1.0'] -> python[version='>=3.6,<3.7.0a0']
Use "conda info <package>" to see the dependencies for each package.
I haven't never met this error on other computer, so I download Anaconda3-4.1.1-Linux-x86_64.sh again
and install.
wget https://repo.continuum.io/archive/Anaconda3-4.1.1-Linux-x86_64.sh
chmod +x Anaconda3-4.1.1-Linux-x86_64.sh
./Anaconda3-4.1.1-Linux-x86_64.sh

(4) create vritual env.
conda create -n zenodo python=3.5.2
and add 清华加速镜像：
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --set show_channel_urls yes

(5) Install npm on host os
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
add native mirror:
(zenodo) root@larry:~/src/zenodo# touch ~/.npmrc
(zenodo) root@larry:~/src/zenodo# vi ~/.npmrc

registry = https://registry.npm.taobao.org

(6) Create virtual python environment
source activate zenodo

(7) Build zenodo on host os, this should be done under virtual python environment created in step6.
(zenodo)$
(zenodo)$ cd ~/src/zenodo
(zenodo)$ pip install -r requirements.txt --src ~/src/ --pre --upgrade
(zenodo)$ pip install -e .[all,postgresql,elasticsearch2]
1、first I meet error:
because I don't use virtuaimport cairo  # pycairo
ImportError: No module named 'cairo'
This command "sudo apt-get install libcairo2" will solve this problem
2、c/_cffi_backend.c:15:17: fatal error: ffi.h: No such file or directory
sudo apt-get install libffi-dev

(8) Install node.js library
编辑 ~/.npmrc 加入下面内容
registry = https://registry.npm.taobao.org

(zenodo)$ sudo ./scripts/setup-npm.sh
I met warning: sh: 1: node: not found
try this: ln -s /usr/bin/nodejs  /usr/bin/node

(zenodo)$ nvm install 7.4
(zenodo)$ nvm use 7.4
this 2 steps will lead to error "Error: Cannot find module '/root/.nvm/versions/node/v7.4.0/lib/node_modules/node-sass/scripts/install.js'" on aliyun, because node-sass havn't been installed correctly. so I ignore these 2 steps.

(zenodo)$ ./scripts/setup-npm.sh
(zenodo)$ ./scripts/setup-assets.sh
1、because I don't use mkvirtualenv, so I will meet 
./scripts/setup-assets.sh: line 29: cd: /var/instance/static: No such file or directory
and I directly run 
npm install
in directory ~/anaconda3/envs/zenodo/var/instance/static
will be ok
or edit ./scripts/setup-assets.sh as below
"cd /root/anaconda3/envs/zenodo/var/instance/static"

(9) Initialize zenodo:
(zenodo)$ ./scripts/init.sh

(10) Run a Celery worker:
(zenodo)$ celery worker -A zenodo.celery -l INFO --purge

(11) Run the Zenodo application:
(zenodo)$ zenodo run -h 0.0.0.0 -p 5000
or with debug mode
(zenodo)$ export FLASK_DEBUG=True
(zenodo)$ zenodo run  --reload --with-threads


